/*! fossil-view 2013-07-22 */
!function(a,b){"function"==typeof define&&define.amd?define(b(a)):b(a)}(this,function(a){"use strict";return a.Fossil||(a.Fossil={}),a.Fossil.View||(a.Fossil.View={}),a.Fossil.View}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone","fossil/view/core"],b):a.Fossil.View.Composite=b(_,Backbone,a.Fossil.View)}(this,function(a,b,c){"use strict";var d={invalid_view:"registerView accept a Backbone.View or an Object as first argument."},e=b.View.prototype,f=c.Composite=b.View.extend({subviews:{},selector:null,_rendered:!1,constructor:function(){e.constructor.apply(this,arguments),this.subviews=a.clone(this.subviews)},registerView:function(c,e){if(c instanceof b.View)return e||(e=a.size(this.subviews)),this.subviews[e]&&this.subviews[e].remove&&this.subviews[e].remove(),this.subviews[e]=c,this._rendered&&this._renderSubview(e),this;var f=a.bind(this.registerView,this);if(a.isArray(c))return a.each(c,function(a){f(a)}),this;if(a.isObject(c))return a.each(c,function(a,b){f(a,b)}),this;throw new Error(d.invalid_view)},getView:function(a){return this.subviews[a]},_renderSubview:function(a,b){var c,d=this.getView(a);if(b||(b={}),d.render(),d.el){var e=this.$el;return this.selector&&(e=this.$(this.selector)),this.options&&this.options.selector&&(e=this.$(this.options.selector)),b.selector&&(e=e.find(b.selector)),b.empty&&e.empty(),0===b.index?(e.prepend(d.el),void 0):b.index?(c="> :nth-child("+parseInt(b.index,10)+")",d.$el.insertAfter(e.find(c)),void 0):(e.append(d.el),void 0)}},template:function(){return a.isFunction(this.options.template)?this.options.template.call(this):this.options.template||""},_renderAllSubviews:function(){var b=this;a.each(this.subviews,function(a,c){b._renderSubview(c)})},_detachAllSubviews:function(){var b=this;a.each(this.subviews,function(a,c){b._detachSubview(c)})},_detachSubview:function(a){var b=this.getView(a);b&&b.$el&&b.$el.detach()},render:function(){return this._detachAllSubviews(),this.$el.html(this.template()),this._renderAllSubviews(),this._rendered=!0,this},remove:function(){e.remove.call(this),this.invokeSubviews("remove"),this._rendered=!1},delegateEvents:function(){e.delegateEvents.call(this),this.invokeSubviews("delegateEvents")},undelegateEvents:function(){e.undelegateEvents.call(this),this.invokeSubviews("undelegateEvents")},invokeSubviews:function(b){var c=a.rest(arguments);return a.map(this.subviews,function(a){a[b].apply(a,c)})}});return f}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone","fossil/view/core","fossil/view/composite"],b):a.Fossil.View.Collection=b(a._,a.Backbone,a.Fossil.View,a.Fossil.View.Composite)}(this,function(a,b,c,d){"use strict";function e(a){a.collection||(a.collection=new b.Collection)}var f=d.prototype,g=c.Collection=d.extend({constructor:function(a){e(this),a&&a.ItemView&&(this.ItemView=a.ItemView),f.constructor.apply(this,arguments),this.bindCollectionEvents()},ItemView:b.View,getView:function(a){return this.subviews[a]||(this.subviews[a]=new this.ItemView(this._getItemViewOptions(a))),this.subviews[a]},_getItemViewOptions:function(a){return{model:this.collection.get(a)}},bindCollectionEvents:function(){this.listenTo(this.collection,"add",a.bind(this.onAddModel,this)),this.listenTo(this.collection,"remove",a.bind(this.onRemoveModel,this)),this.listenTo(this.collection,"sort",a.bind(this.onCollectionSort,this)),this.listenTo(this.collection,"sync",a.bind(this.onCollectionSync,this))},onAddModel:function(a,b,c){var d=a.cid;this.subviews[d]&&this.subviews[d].remove&&(this.subviews[d].remove(),this.subviews[d]=null),this._rendered&&this._renderSubview(d,{index:c.at})},onRemoveModel:function(a){var b=a.cid;this.getView(b).remove(),delete this.subviews[b]},onCollectionSort:function(){this.render()},onCollectionSync:function(){console.log(arguments)},_renderAllSubviews:function(){var a=this;this.collection.each(function(b){a._renderSubview(b.cid)})}});return g}),function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone","fossil/view/core","fossil/view/composite"],b):a.Fossil.View.RegionManager=b(a._,a.Backbone,a.Fossil.View,a.Fossil.View.Composite)}(this,function(a,b,c,d){"use strict";function e(a,b,c,d){a.regions[b]=c,d&&a.registerView(d,b)}var f={require_region:a.template("Unknown region <%- id %>")},g=d.prototype,h=c.RegionManager=d.extend({regions:{},constructor:function(b){b||(b={}),this.regions=a.clone(this.regions),this.defineRegion(b.regions||this.regions),g.constructor.apply(this,arguments)},defineRegion:function(b,c,d){var f=this;if(a.isObject(b)){var g=c||{};return a.each(b,function(a,b){var c;g&&g[b]&&(c=g[b]),e(f,b,a,c)}),this}return e(f,b,c,d),this},_renderSubview:function(b,c){if(this.getView(b)){if(!this.regions[b])throw new Error(f.require_region({id:b}));return c=a.extend({empty:!0,selector:this.regions[b]},c||{}),g._renderSubview.call(this,b,c)}},_renderAllSubviews:function(){var b=this;a.each(this.regions,function(a,c){b._renderSubview(c)})}});return h});