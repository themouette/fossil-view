/*! fossil-view 2013-10-11 */
window.Fossil||(window.Fossil={}),window.Fossil.Views=function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=s.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function g(b,c){return function(){return n.apply(a,v.call(arguments,0).concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[];if(f=f||c,"function"==typeof e){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e.apply(q[c],u),c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){return"string"==typeof b?p[b]?p[b](c):j(o(b,c).f):(b.splice||(s=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n)},n.config=function(a){return s=a,s.deps&&n(s.deps,s.callback),n},c._defined=q,e=function(a,c,d){c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("underscore",[],function(){return a}),e("backbone",[],function(){return b}),e("view",["backbone"],function(b){return b.View.extend({template:null,recycle:!1,_rendered:!1,_pluginsAttached:!1,constructor:function(c){var d=this;b.View.apply(this,arguments),a.each(["template","recycle","attachPlugins","detachPlugins"],function(a){c&&"undefined"!=typeof c[a]&&(d[a]=c[a])})},render:function(){var b,c;return this.precompile&&(this.template=this.precompile(this.template)),b={},this.getViewData&&(b=this.getViewData()),c=this.template,this.renderHtml&&(c=this.renderHtml.apply(this,[b].concat(a.toArray(arguments)))),this.$el.html(c),this.onRendered&&this.onRendered.apply(this,arguments),this._attachPlugins(),this._rendered=!0,this},_attachPlugins:function(){this.isAttachedToDOM()&&this.attachPlugins&&(this._detachPlugins(this),this.attachPlugins(),this._pluginsAttached=!0)},_detachPlugins:function(){this._pluginsAttached&&this.detachPlugins&&(this.detachPlugins(),this._pluginsAttached=!1)},detach:function(){return this._detachPlugins(this),this.$el&&this.$el.detach&&this.$el.detach(),this},remove:function(a){return!a&&this.recycle?this.detach():(this._detachPlugins(this),b.View.prototype.remove.apply(this,arguments),this._rendered=!1,this)},isAttachedToDOM:function(){return this.$el.parents(":last").is("html")}})}),e("composite",["underscore","backbone","./view"],function(a,b,c){function d(a,b,c){return 0===c.index?(b.prepend(a.el),void 0):c.index?(selector="> :nth-child("+parseInt(c.index,10)+")",a.$el.insertAfter(b.find(selector)),void 0):(b.append(a.el),void 0)}var e={invalid_view:"registerView accept a Backbone.View or an Object as first argument."},f=c.prototype,g=c.extend({subviews:{},selector:null,manageRendering:!0,constructor:function(){var b=this;f.constructor.apply(this,arguments),this.subviews=a.clone(this.subviews),a.each(["selector","manageRendering"],function(a){"undefined"!=typeof b.options[a]&&(b[a]=b.options[a])})},registerView:function(c,d){if(c instanceof b.View)return d||(d=a.size(this.subviews)),this.subviews[d]&&this.removeView(d),this.subviews[d]=c,this._rendered&&this._renderSubview(d),this.subviews[d]._attachPlugins?this.subviews[d]._attachPlugins():this.subviews[d].attachPlugins&&this.subviews[d].attachPlugins(),this;var f=a.bind(this.registerView,this);if(a.isArray(c))return a.each(c,function(a){f(a)}),this;if(a.isObject(c))return a.each(c,function(a,b){f(a,b)}),this;throw new Error(e.invalid_view)},getView:function(a){return this.subviews[a]},_renderSubview:function(b,c){var e=this.getView(b),f=a.tail(arguments,2);if(c||(c={}),!this.manageRendering||e._rendered&&e.recycle||e.render.apply(e,f),e.el){var g=this.$el;this.selector&&(g=this.$(this.selector)),c.selector&&(g=g.find(c.selector)),c.empty&&g.empty(),d(e,g,c)}},_renderAllSubviews:function(){var b=this,c=a.toArray(arguments);a.each(this.subviews,function(a,d){b._renderSubview.apply(b,[d,{}].concat(c))})},_detachAllSubviews:function(){var b=this;a.each(this.subviews,function(a,c){b.detachView(c)})},detachView:function(a){var b=this.getView(a);if(b)return b.detach?(b.detach(),void 0):(b.$el&&b.$el.detach(),void 0)},removeView:function(a,b){var c=this.getView(a);c&&c.remove&&c.remove(b)},render:function(){return this._detachAllSubviews(),f.render.apply(this,arguments),this},onRendered:function(){this._renderAllSubviews.apply(this,arguments)},invokeSubviews:function(b){var c=a.rest(arguments);return a.map(this.subviews,function(a){"function"==typeof a[b]&&a[b].apply(a,c)})},_attachPlugins:function(){this.isAttachedToDOM()&&(f._attachPlugins.apply(this,arguments),a.each(this.subviews,function(a){a._attachPlugins?a._attachPlugins():a.attachPlugins&&a.attachPlugins()}))},_detachPlugins:function(){var b=arguments;return f._detachPlugins.apply(this,arguments),a.map(this.subviews,function(a){"function"==typeof a._detachPlugin?a._detachPlugin.apply(a,b):"function"==typeof a.detachPlugin&&a.detachPlugin.apply(a,b)})},remove:function(a){f.remove.apply(this,arguments),(a||!this.recycle)&&this.invokeSubviews("remove")}});return a.each(["delegateEvents","undelegateEvents"],function(a){g.prototype[a]=function(){f[a].apply(this,arguments),this.invokeSubviews(a)}}),g}),e("collection",["underscore","backbone","./composite","./view"],function(a,b,c,d){function e(a){a.collection||(a.collection=new b.Collection)}var f=c.prototype,g=c.extend({constructor:function(a){e(this),a&&a.ItemView&&(this.ItemView=a.ItemView),f.constructor.apply(this,arguments),this.bindCollectionEvents()},ItemView:d,getView:function(a){return this.subviews[a]||(this.subviews[a]=new this.ItemView(this._getItemViewOptions(a))),this.subviews[a]},_getItemViewOptions:function(a){return{model:this.collection.get(a)}},bindCollectionEvents:function(){this.listenTo(this.collection,"add",a.bind(this.onAddModel,this)),this.listenTo(this.collection,"remove",a.bind(this.onRemoveModel,this)),this.listenTo(this.collection,"sort",a.bind(this.onCollectionSort,this)),this.listenTo(this.collection,"sync",a.bind(this.onCollectionSync,this))},onAddModel:function(a,b,c){var d=a.cid;this.subviews[d]&&this.subviews[d].remove&&(this.subviews[d].remove(),this.subviews[d]=null),this._rendered&&this._renderSubview(d,{index:c.at})},onRemoveModel:function(a){var b=a.cid;this.getView(b).remove(),delete this.subviews[b]},onCollectionSort:function(){this.render()},onCollectionSync:function(){console.log(arguments)},_renderAllSubviews:function(){var b=this,c=a.toArray(arguments);this.collection.each(function(a){b._renderSubview.apply(b,[a.cid,{}].concat(c))})}});return g}),e("regionManager",["underscore","backbone","./composite"],function(a,b,c){function d(a,b,c,d){a.regions[b]=c,d&&a.registerView(d,b)}var e={require_region:a.template("Unknown region <%- id %>")},f=c.prototype,g=c.extend({regions:{},constructor:function(b){b||(b={}),this.regions=a.clone(this.regions),this.defineRegion(b.regions||this.regions),f.constructor.apply(this,arguments)},defineRegion:function(b,c,e){var f=this;if(a.isObject(b)){var g=c||{};return a.each(b,function(a,b){var c;g&&g[b]&&(c=g[b]),d(f,b,a,c)}),this}return d(f,b,c,e),this},_renderSubview:function(b,c){if(this.getView(b)){if(!this.regions[b])throw new Error(e.require_region({id:b}));var d=a.tail(arguments,2);return c=a.extend({empty:!0,selector:this.regions[b]},c||{}),f._renderSubview.apply(this,[b,c].concat(d))}},_renderAllSubviews:function(){var b=this,c=a.toArray(arguments);a.each(this.regions,function(a,d){b._renderSubview.apply(b,[d,{}].concat(c))})}});return g}),d("view"),d("composite"),d("collection"),d("regionManager"),{View:d("view"),Composite:d("composite"),Collection:d("collection"),RegionManager:d("regionManager")}}(_,Backbone);