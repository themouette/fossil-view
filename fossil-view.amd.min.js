/*! fossil-view 2013-07-22 */
define("fossil/view",["underscore","backbone","jquery","fossil"],function(a,b,c,d){var e=function(a,b){"use strict";return a.View||(a.View=b.View.extend({})),a.Views||(a.Views={}),a.Views}(d,b);return function(a,b,c,d){"use strict";var e={invalid_view:"registerView accept a Backbone.View or an Object as first argument."},f=c.View.prototype,g=d.Composite=c.View.extend({subviews:{},selector:null,_rendered:!1,constructor:function(){f.constructor.apply(this,arguments),this.subviews=a.clone(this.subviews)},registerView:function(c,d){if(c instanceof b.View)return d||(d=a.size(this.subviews)),this.subviews[d]&&this.subviews[d].remove&&this.subviews[d].remove(),this.subviews[d]=c,this._rendered&&this._renderSubview(d),this;var f=a.bind(this.registerView,this);if(a.isArray(c))return a.each(c,function(a){f(a)}),this;if(a.isObject(c))return a.each(c,function(a,b){f(a,b)}),this;throw new Error(e.invalid_view)},getView:function(a){return this.subviews[a]},_renderSubview:function(a,b){var c,d=this.getView(a);if(b||(b={}),d.render(),d.el){var e=this.$el;return this.selector&&(e=this.$(this.selector)),this.options&&this.options.selector&&(e=this.$(this.options.selector)),b.selector&&(e=e.find(b.selector)),b.empty&&e.empty(),0===b.index?(e.prepend(d.el),void 0):b.index?(c="> :nth-child("+parseInt(b.index,10)+")",d.$el.insertAfter(e.find(c)),void 0):(e.append(d.el),void 0)}},template:function(){return a.isFunction(this.options.template)?this.options.template.call(this):this.options.template||""},_renderAllSubviews:function(){var b=this;a.each(this.subviews,function(a,c){b._renderSubview(c)})},_detachAllSubviews:function(){var b=this;a.each(this.subviews,function(a,c){b._detachSubview(c)})},_detachSubview:function(a){var b=this.getView(a);b&&b.$el&&b.$el.detach()},render:function(){return this._detachAllSubviews(),this.$el.html(this.template()),this._renderAllSubviews(),this._rendered=!0,this},remove:function(){f.remove.call(this),this.invokeSubviews("remove"),this._rendered=!1},delegateEvents:function(){f.delegateEvents.call(this),this.invokeSubviews("delegateEvents")},undelegateEvents:function(){f.undelegateEvents.call(this),this.invokeSubviews("undelegateEvents")},invokeSubviews:function(b){var c=a.rest(arguments);return a.map(this.subviews,function(a){a[b].apply(a,c)})}});return g}(a,b,d,e),function(a,b,c){"use strict";function d(a){a.collection||(a.collection=new b.Collection)}var e=c.Composite.prototype,f=c.Collection=c.Composite.extend({constructor:function(a){d(this),a&&a.ItemView&&(this.ItemView=a.ItemView),e.constructor.apply(this,arguments),this.bindCollectionEvents()},ItemView:b.View,getView:function(a){return this.subviews[a]||(this.subviews[a]=new this.ItemView(this._getItemViewOptions(a))),this.subviews[a]},_getItemViewOptions:function(a){return{model:this.collection.get(a)}},bindCollectionEvents:function(){this.listenTo(this.collection,"add",a.bind(this.onAddModel,this)),this.listenTo(this.collection,"remove",a.bind(this.onRemoveModel,this)),this.listenTo(this.collection,"sort",a.bind(this.onCollectionSort,this)),this.listenTo(this.collection,"sync",a.bind(this.onCollectionSync,this))},onAddModel:function(a,b,c){var d=a.cid;this.subviews[d]&&this.subviews[d].remove&&(this.subviews[d].remove(),this.subviews[d]=null),this._rendered&&this._renderSubview(d,{index:c.at})},onRemoveModel:function(a){var b=a.cid;this.getView(b).remove(),delete this.subviews[b]},onCollectionSort:function(){this.render()},onCollectionSync:function(){console.log(arguments)},_renderAllSubviews:function(){var a=this;this.collection.each(function(b){a._renderSubview(b.cid)})}});return f}(a,b,e),function(a,b,c){"use strict";function d(a,b,c,d){a.regions[b]=c,d&&a.registerView(d,b)}var e={require_region:a.template("Unknown region <%- id %>")},f=c.Composite.prototype,g=c.RegionManager=c.Composite.extend({regions:{},constructor:function(b){b||(b={}),this.regions=a.clone(this.regions),this.defineRegion(b.regions||this.regions),f.constructor.apply(this,arguments)},defineRegion:function(b,c,e){var f=this;if(a.isObject(b)){var g=c||{};return a.each(b,function(a,b){var c;g&&g[b]&&(c=g[b]),d(f,b,a,c)}),this}return d(f,b,c,e),this},_renderSubview:function(b,c){if(this.getView(b)){if(!this.regions[b])throw new Error(e.require_region({id:b}));return c=a.extend({empty:!0,selector:this.regions[b]},c||{}),f._renderSubview.call(this,b,c)}},_renderAllSubviews:function(){var b=this;a.each(this.regions,function(a,c){b._renderSubview(c)})}});return g}(a,b,e),d.Views});